# 学习笔记

## 第四周作业

### 1 作业一：线程运行方法得到返回值

&ensp;&ensp;作业要求：思考有多少种方式，在 main 函数启动一个新线程，运行一个方法，拿到这 

个方法的返回值后，退出主线程？ 写出你的方法，越多越好，提交到 Github。 

#### 2.1 分为几个大类：

1）分工类

2）协作类

3）互斥类

#### 2.2 分工类

1）Executor、Fork/Join、Future

2）协作类

3）互斥类

#### 2.3 协作类

1）信号量

2）管程

3）CountDownLatch

CyclicBarrier

Phaser

Exchanger







### 2 作业二：用脑图梳理多线程和并发知识

&ensp;&ensp;作业要求：把多线程和并发相关知识带你梳理一遍，画一个脑图，截图上传到 Github 

上。 可选工具：xmind，百度脑图，wps，MindManage或其他。

#### 2.1 并发编程全景图

1）建立一张全景图，将并发编程抽象成三个核心问题：分工、同步、互斥。

2）并发编程的Bug源头：可见性、原子性、有序性

#### 2.2 分工

1）**定义**：所谓分工，类似于现实中一个组织完成一个项目，项目经理要拆分任务，安排合适的成员去完成。

2）并发领域里，分工很重要，它直接决定了并发程序的性能。

3）**学习分工**：最佳的方式就是和现实世界做对比。例如生产者和消费者，可以分别类比大厨和服务员。

#### 2.3 同步

1）**定义**：在并发编程领域里的同步，主要指线程间的协作，指一个线程执行完任务，如何通知执行后续任务的线程开工。

2）协作一般是和分工相关的，但很多场景需要自己来处理线程之间的协作。
例如：Executor、Fork/Join、Future 本质上都是分工方法，但同时也能解决线程协作的问题。

3）工作中的线程协作问题：当某个条件不满足时，线程需要等待，当某个条件满足时，线程需要被唤醒执行。

4） 在 Java 并发编程领域，解决协作问题的核心技术是管程，管程是一种解决并发问题的通用模型，可以解决线程协作和互斥问题。

5）**管程是解决并发问题的万能钥匙。**

6）**学习同步**：关键是理解管程模型，学好它可以解决所有问题。此外，了解并发包提供线程协作的工具类应用场景，可以提高工作效率。

#### 2.4 互斥

1）**定义**：互斥指的是同一时刻，只允许一个线程访问共享变量。

2）**区别**：分工、同步主要强调的是性能，互斥强调的是正确性（线程安全）。

3）导致不确定性的源头：可见性问题、有序性问题和原子性问题。

4） Java语言引入内存模型，可以避免可见性、有序性问题，但不能完全解决线程安全问题。

5）解决线程安全问题的核心方案还是互斥，实现互斥的核心技术就是锁，锁解决了安全性问题，但同时也带来了性能问题。

6）保证安全同时改善性能问题可以考虑：分场景优化（例如 ReadWriteLock、StampedLock）、使用无锁的数据结构（例如原子类）、以及原理是不共享变量或者变量只读的其他方案（例如Thread Local 和 final 关键字、Copy-on-write 模式）

7）锁除了要注意性能问题外，还需要注意死锁问题。其中，可见性：cpu和缓存；原子性：操作系统；无锁算法：cpu缓存。

#### 2.5 并发bug三源头

1）**缓存导致的可见性问题**

2）**线程切换带来的原子性问题**

3）**编译优化带来的有序性问题**







  * #### 参考文献

      [1]王宝令. Java并发编程实战[M]. 极客时间, 2019.

      [2]爱读书的张先生. 并发编程专题[M]. CSDN, 2020.

      

